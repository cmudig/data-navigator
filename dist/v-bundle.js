(()=>{"use strict";const e={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down",Period:"forward",Comma:"backward",Escape:"parent",Enter:"child"},t={down:{keyCode:"ArrowDown",direction:1},left:{keyCode:"ArrowLeft",direction:-1},right:{keyCode:"ArrowRight",direction:1},up:{keyCode:"ArrowUp",direction:-1},backward:{keyCode:"Comma",direction:-1},child:{keyCode:"Enter",direction:1},parent:{keyCode:"Backspace",direction:-1},forward:{keyCode:"Period",direction:1},exit:{keyCode:"Escape",direction:1}},n=(e,t)=>{const n=Object.keys(e);let o="";return n.forEach((n=>{o+=`${t.omitKeyNames?"":n+": "}${e[n]}. `})),o+=t.semanticLabel||"Data point.",o};let o,i,s;console.log("yo");const r=(e,t,n)=>e.marktype&&!("text"===e.marktype),a=(e,t,n,o)=>!("axis"===n.role||"legend"===n.role),d=(e,t,n,o,i)=>!0,l=(e,t,o)=>{if(Object.keys(e).length)return n(e,{});if(e.role=t.role,"axis"===t.role){const e=t.items[0].items[0].items;return`${"yscale"===t.items[0].datum.scale?"Y ":"xscale"===t.items[0].datum.scale?"X ":""}Axis. Values range from ${e[0].datum.label} to ${e[e.length-1].datum.label}.`}if("mark"===t.role)return`${t.items.length} navigable data elements. Group. Enter using Down Arrow.`;if("legend"===t.role){const e=t.items[0].items[0].items[0].items[0].items;return`Legend: ${i.legends[0].title}. Showing values from ${e[0].items[1].items[0].datum.label} to ${e[e.length-1].items[1].items[0].datum.label}.`}return`${o}.`},c=()=>(s.exit(),"");fetch("https://vega.github.io/vega/examples/scatter-plot.vg.json").then((e=>e.json())).then((e=>(i=e,u(e)))).then((o=>{const u=(e=>{console.log("extractStructureFromVegaLite",e);let t={},o={},i=0;const s=e.groupInclusionCriteria?e.groupInclusionCriteria:()=>!0,r=e.itemInclusionCriteria?e.itemInclusionCriteria:()=>!0,a=e.datumInclusionCriteria?e.datumInclusionCriteria:()=>!0,d=e.vegaLiteView._renderer._origin,l=e.vegaLiteView._scenegraph.root.items[0].mark.items[0],c=(e,t)=>{if(e["data-navigator-id"])return e["data-navigator-id"];const n=`dn-node-${t}-${i}`;return i++,e["data-navigator-id"]=n,n},u=(o,i,s,r,d)=>{const l=c(o,i),u=s||[0,0];t[l]={},t[l].d={},t[l].id=l,t[l].x=o.bounds.x1+u[0],t[l].y=o.bounds.y1+u[1],t[l].width=o.bounds.x2-o.bounds.x1,t[l].height=o.bounds.y2-o.bounds.y1,t[l].cssClass="dn-vega-lite-node",t[l].index=r,t[l].level=i,t[l].parent=d,o.datum&&Object.keys(o.datum).forEach((n=>{const s=o.datum[n];a(n,s,o.datum,i,e.vegaLiteSpec)&&(t[l].d[e.keyRenamingHash&&e.keyRenamingHash[n]?e.keyRenamingHash[n]:n]=s)})),t[l].description=e.nodeDescriber?e.nodeDescriber(t[l].d,o,i):n(t[l].d)};let g=0;return l.items.forEach((t=>{if(s(t,g,e.vegaLiteSpec)){u(t,"group",d,g,l);let n=0;const o=t.items[0].mark.items[0].items?t.items[0].mark.items[0]:t;o.items.forEach((i=>{r(i,n,t,e.vegaLiteSpec)&&u(i,"item",d,n,o),n++}))}g++})),Object.keys(t).forEach((n=>{t[n].edges=(n=>{const i=t[n],s=i.index,r=i.level,a=i.parent,d=[],l=a.items[s-1];if(l){const e=c(l,r);if(t[e]){const t=`${e}-${i.id}`;d.push(t),o[t]||(o[t]={source:e,target:i.id,type:"sibling"})}}const u=a.items[s+1];if(u){const e=c(u,r);if(t[e]){const t=`${i.id}-${e}`;d.push(t),o[t]||(o[t]={source:i.id,target:e,type:"sibling"})}}if("group"===r&&a.items[s].items){const e=(a.items[s].items[0].mark.items[0].items||a.items[s].items)[0],n=c(e,"item");if(t[n]){const e=`${i.id}-${n}`;d.push(e),o[e]||(o[e]={source:i.id,target:n,type:"level"})}}else if("item"===r){const e=c(a,"group");if(t[e]){const t=`${e}-${i.id}`;d.push(t),o[t]||(o[t]={source:e,target:i.id,type:"level"})}}return e.exitFunction&&(d.push("any-exit"),o["any-exit"]||(o["any-exit"]={source:(e,t,n)=>t,target:e.exitFunction,type:"exit"})),d.push("any-undo"),o["any-undo"]||(o["any-undo"]={source:(e,t,n)=>t,target:(e,t,n)=>n,type:"undo"}),d})(n)})),console.log("total",i),console.log("repeated",0),{data:{nodes:t,edges:o},navigation:{right:{types:["sibling"],key:"ArrowRight",direction:1},left:{types:["sibling"],key:"ArrowLeft",direction:-1},down:{types:["level"],key:"ArrowDown",direction:1},up:{types:["level"],key:"ArrowUp",direction:-1},exit:{types:["exit"],key:"Escape",direction:1},undo:{types:["undo"],key:"Backspace",direction:1},legend:{types:["legend"],key:"KeyL",direction:1}}}})({vegaLiteView:o,vegaLiteSpec:i,groupInclusionCriteria:r,itemInclusionCriteria:a,datumInclusionCriteria:d,keyRenamingHash:{},nodeDescriber:l,exitFunction:c}),g={data:{nodes:u.data.nodes,edges:u.data.edges},navigation:u.navigation,id:"data-navigator-schema",root:{id:"view",cssClass:"",width:"100%",height:0}};return console.log("dnBuildOptions",g),s=(n=>{let o={},i=null,s=null,r=null,a=null,d=e,l=t,c=null,u=null;const g=e=>{const t=d[e.code];t&&(e.preventDefault(),o.move(t))},p=e=>{},m=e=>{},y=e=>{const t=document.getElementById(e);t&&(t.removeEventListener("keydown",g),t.removeEventListener("focus",p),t.removeEventListener("blur",m),t.remove())},h=(e,t)=>{(e=>{const t=document.createElement("figure");t.setAttribute("role","figure"),t.id=e,t.classList.add("dn-node");const o=n.data.nodes[e];o.cssClass&&t.classList.add(o.cssClass),t.style.width=parseFloat(o.width||"0")+"px",t.style.height=parseFloat(o.height||"0")+"px",t.style.left=parseFloat(o.x||"0")+"px",t.style.top=parseFloat(o.y||"0")+"px",t.setAttribute("tabindex","-1"),t.addEventListener("keydown",g),t.addEventListener("focus",p),t.addEventListener("blur",m);const i=document.createElement("div");if(i.setAttribute("role","img"),i.classList.add("dn-node-text"),n.showText&&(i.innerText=o.description),i.setAttribute("aria-label",o.description),t.appendChild(i),o.path){const e=parseFloat(o.width||"0")+parseFloat(o.x||"0")+10,n=parseFloat(o.height||"0")+parseFloat(o.y||"0")+10,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",e),i.setAttribute("height",n),i.setAttribute("viewBox",`0 0 ${e} ${n}`),i.style.left=-parseFloat(o.x||0),i.style.top=-parseFloat(o.y||0),i.classList.add("dn-node-svg"),i.setAttribute("role","presentation"),i.setAttribute("focusable","false"),i.setAttribute("tabindex","-1");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",o.path),s.classList.add("dn-node-path"),i.appendChild(s),t.appendChild(i)}u.appendChild(t)})(e),(e=>{const t=document.getElementById(e);t&&(s=i,i=e,t.focus())})(e),y(t)};return o.getCurrentFocus=()=>i,o.getPreviousFocus=()=>s,o.setNavigationKeyBindings=n=>{n?(d={},l=n,Object.keys(n).forEach((e=>{const t=n[e];d[t.key]=e}))):(d=e,l=t)},o.build=()=>{if(console.log("building",n),n.data)if(r=n.entryPoint?n.entryPoint:Object.keys(n.data.nodes)[0],n.root&&document.getElementById(n.root.id)){if(c=document.getElementById(n.root.id),c.style.position="relative",c.classList.add("dn-root"),n.id){u=document.createElement("div"),u.id="dn-wrapper-"+n.id,u.classList.add("dn-wrapper"),u.style.width=n.root&&n.root.width?n.root.width:"100%",n.root&&n.root.height&&(u.style.height=n.root.height);const e=document.createElement("button");return e.id="dn-entry-button-"+n.id,e.classList.add("dn-entry-button"),e.innerText="Enter navigation area",e.addEventListener("click",o.enter),u.appendChild(e),a=document.createElement("div"),a.id="dn-exit-"+n.id,a.classList.add("dn-exit-position"),a.innerText="End of data structure.",a.setAttribute("aria-label","End of data structure."),a.setAttribute("role","note"),a.setAttribute("tabindex","-1"),a.style.display="none",a.addEventListener("focus",(()=>{a.style.display="block",y(i),s=i,i=null})),a.addEventListener("blur",(()=>{a.style.display="none"})),o.setNavigationKeyBindings(n.navigation),c.appendChild(u),c.appendChild(a),c}console.error("No id found: options.id must be specified for dataNavigator.build")}else console.error("No root element found, cannot build: options.root.id must reference an existing DOM element.");else console.error("No data found, cannot enter: options.data must contain a valid hash object of data for dn.build")},o.move=e=>{if(i){const t=n.data.nodes[i];if(t.edges){let o=null,r=0;const a=l[e],d=a.types||e,c=(e,n)=>{if(e!==n.type)return null;const o="string"==typeof n.target?n.target:n.target(t,i,s),r="string"==typeof n.source?n.source:n.source(t,i,s),d=r===i?1:o===i?-1:0,l=1===d?o:-1===d?r:null;return l&&d===a.direction?l:null};for(r=0;r<t.edges.length;r++){const e=n.data.edges[t.edges[r]];if(Array.isArray(d)?d.forEach((t=>{o||(o=c(t,e))})):o=c(d,e),o)break}o&&(console.log("target",n.data.nodes[o],n.data.nodes[o].description),h(o,i))}}},o.moveTo=e=>{const t=document.getElementById(e);t?(s=i,i=e,t.focus()):h(e,i)},o.enter=()=>{o.moveTo(r)},o.exit=()=>{a.style.display="block",a.focus()},o.hooks={},o.hooks.navigation=()=>{},o.hooks.focus=()=>{},o.hooks.selection=()=>{},o.hooks.keydown=()=>{},o.hooks.pointerClick=()=>{},o})(g),s.build(),window.dn=s,g})).catch((e=>console.error(e)));const u=e=>(o=new vega.View(vega.parse(e),{renderer:"canvas",container:"#view",hover:!0}),o.runAsync()),g=new Hammer(document.body,{});g.get("pinch").set({enable:!1}),g.get("rotate").set({enable:!1}),g.get("pan").set({enable:!1}),g.get("swipe").set({direction:Hammer.DIRECTION_ALL,velocity:.2}),g.on("press",(e=>{})),g.on("pressup",(e=>{s.enter()})),g.on("swipe",(e=>{const t=Math.abs(e.deltaX)>Math.abs(e.deltaY)?"X":"Y",n=(Math.abs(e["delta"+t])+1e-9)/(Math.abs(e["delta"+("X"===t?"Y":"X")])+1e-9),o=e.deltaX<0,i=e.deltaX>0,r=e.deltaY<0,a=e.deltaY>0,d=n>.99&&n<=2?i&&r?"forward":i&&a?"child":o&&a?"backward":o&&r?"parent":null:i&&"X"===t?"right":a&&"Y"===t?"down":o&&"X"===t?"left":r&&"Y"===t?"up":null;s.getCurrentFocus()&&d&&s.move(d)}))})();